<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Exceptions and Fault tolerance
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="An open source framework for large-scale distributed computation and data processing written in F#."/>
    <meta name="author" content="Jan Dzik, Nick Palladinos, Kostas Rontogiannis, Eirik Tsarpalis"/>
    
    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link rel="icon" type="image/png" href="http://www.mbrace.io/img/favicon-196x196.png" sizes="196x196"/>
    <link rel="icon" type="image/png" href="http://www.mbrace.io/img/favicon-160x160.png" sizes="160x160"/>
    <link rel="icon" type="image/png" href="http://www.mbrace.io/img/favicon-96x96.png" sizes="96x96"/>
    <link rel="icon" type="image/png" href="http://www.mbrace.io/img/favicon-16x16.png" sizes="16x16"/>
    <link rel="icon" type="image/png" href="http://www.mbrace.io/img/favicon-32x32.png" sizes="32x32"/>

    <link type="text/css" rel="stylesheet" href="http://www.mbrace.io/content/style.css" />
    <script type="text/javascript" src="http://www.mbrace.io/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://github.com/mbraceproject/MBrace.Core">github page</a></li>
        </ul>
        <h3 class="muted"><a href="http://www.mbrace.io/index.html">MBrace.Core and MBrace.Azure</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Exceptions-and-Fault-tolerance" class="anchor" href="#Exceptions-and-Fault-tolerance">Exceptions and Fault tolerance</a></h1>
<blockquote>
<p>This tutorial is from the <a href="https://github.com/mbraceproject/MBrace.StarterKit">MBrace Starter Kit</a>.</p>
</blockquote>
<p>In this tutorial we will be offering an overview of the MBrace exception handling
features as well as its fault tolerance mechanism.</p>
<h2><a name="Exception-handling" class="anchor" href="#Exception-handling">Exception handling</a></h2>
<p>Just like async, mbrace workflows support exception handling:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">cloud</span> { <span class="k">do</span> <span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="i">failwith</span> <span class="s">&quot;kaboom!&quot;</span> } <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs7', 15)" onmouseover="showTip(event, 'fs7', 15)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 16)" onmouseover="showTip(event, 'fs11', 16)" class="f">Run</span>
</code></pre></td>
</tr>
</table>
<p>Sending the above computation to your cluster will have the expected behaviour,
any user exception will be caught and rethrown on the client side:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="console">System.Exception: kaboom!
   at FSI_0010.it@24-3.Invoke(Unit unitVar)
   at MBrace.Core.BuilderImpl.Invoke@98.Invoke(Continuation`1 c) in ...
--- End of stack trace from previous location where exception was thrown ---
   at &lt;StartupCode$MBrace-Runtime&gt;.$CloudProcess.AwaitResult@211-2.Invoke(CloudProcessResult _arg2) in ...
   at Microsoft.FSharp.Control.AsyncBuilderImpl.args@835-1.Invoke(a a)
   at MBrace.Core.Internals.AsyncExtensions.Async.RunSync[T](FSharpAsync`1 workflow, ...
   at &lt;StartupCode$FSI_0010&gt;.$FSI_0010.main@() in ...
Stopped due to error
</code></pre></td></tr></table>
<p>This has interesting ramifications when our cloud computation spans multiple machines:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">cloud</span> {
    <span class="k">let</span> <span class="i">div</span> <span class="i">m</span> <span class="i">n</span> <span class="o">=</span> <span class="i">cloud</span> { <span class="k">return</span> <span class="i">m</span> <span class="o">/</span> <span class="i">n</span> }
    <span class="k">let!</span> <span class="i">results</span> <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Parallel</span> [<span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="n">10</span> <span class="k">-&gt;</span> <span class="i">div</span> <span class="n">10</span> (<span class="n">5</span> <span class="o">-</span> <span class="i">i</span>) ]
    <span class="k">return</span> <span onmouseout="hideTip(event, 'fs12', 17)" onmouseover="showTip(event, 'fs12', 17)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 18)" onmouseover="showTip(event, 'fs13', 18)" class="i">sum</span> <span class="i">results</span>
}
</code></pre></td>
</tr>
</table>
<p>In the example above, we perform a calculation in parallel across the cluster
in which one of the child work items are going to fail with a user exception.
In the event of such an uncaught error, the exception will bubble up to the parent computation,
actively cancelling any of the outstanding sibling computations:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="console">System.DivideByZeroException: Attempted to divide by zero.
   at FSI_0013.div@47-1.Invoke(Unit unitVar)
   at MBrace.Core.BuilderImpl.Invoke@98.Invoke(Continuation`1 c) in ...
   at Cloud.Parallel(seq&lt;Cloud&lt;Int32&gt;&gt; computations)
--- End of stack trace from previous location where exception was thrown ---
   at &lt;StartupCode$MBrace-Runtime&gt;.$CloudProcess.AwaitResult@211-2.Invoke(CloudProcessResult _arg2) in ...
   at Microsoft.FSharp.Control.AsyncBuilderImpl.args@835-1.Invoke(a a)
   at MBrace.Core.Internals.AsyncExtensions.Async.RunSync[T](FSharpAsync`1 ...
   at &lt;StartupCode$FSI_0014&gt;.$FSI_0014.main@()
</code></pre></td></tr></table>
<p>While the stacktrace offers a precise indication of what went wrong,
it may be a bit ambiguous on <em>how</em> and <em>where</em> it went wrong.
Let's see how we can use MBrace to improve this in our example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">exception</span> <span onmouseout="hideTip(event, 'fs14', 19)" onmouseover="showTip(event, 'fs14', 19)" class="t">WorkerException</span> <span class="k">of</span> <span class="i">worker</span><span class="o">:</span><span class="i">IWorkerRef</span> <span class="o">*</span> <span class="i">input</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs15', 20)" onmouseover="showTip(event, 'fs15', 20)" class="t">int</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs16', 21)" onmouseover="showTip(event, 'fs16', 21)" class="i">exn</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs16', 22)" onmouseover="showTip(event, 'fs16', 22)" class="t">exn</span>
<span class="k">with</span>
    <span class="k">override</span> <span onmouseout="hideTip(event, 'fs17', 23)" onmouseover="showTip(event, 'fs17', 23)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs18', 24)" onmouseover="showTip(event, 'fs18', 24)" class="i">Message</span> <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs19', 25)" onmouseover="showTip(event, 'fs19', 25)" class="f">sprintf</span> <span class="s">&quot;Worker &#39;</span><span class="pf">%O</span><span class="s">&#39; given input </span><span class="pf">%d</span><span class="s"> has failed with exception:\n&#39;</span><span class="pf">%O</span><span class="s">&#39;&quot;</span> 
            <span onmouseout="hideTip(event, 'fs17', 26)" onmouseover="showTip(event, 'fs17', 26)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 27)" onmouseover="showTip(event, 'fs20', 27)" class="i">worker</span> <span onmouseout="hideTip(event, 'fs17', 28)" onmouseover="showTip(event, 'fs17', 28)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 29)" onmouseover="showTip(event, 'fs21', 29)" class="i">input</span> <span onmouseout="hideTip(event, 'fs17', 30)" onmouseover="showTip(event, 'fs17', 30)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 31)" onmouseover="showTip(event, 'fs22', 31)" class="i">exn</span>


<span class="i">cloud</span> {
    <span class="k">let</span> <span class="i">div</span> <span class="i">n</span> <span class="o">=</span> <span class="i">cloud</span> { 
        <span class="k">try</span> <span class="k">return</span> <span class="n">10</span> <span class="o">/</span> (<span class="n">5</span> <span class="o">-</span> <span class="i">n</span>)
        <span class="k">with</span> <span class="i">e</span> <span class="k">-&gt;</span> 
            <span class="k">let!</span> <span class="i">currentWorker</span> <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">CurrentWorker</span>
            <span class="k">return</span> <span onmouseout="hideTip(event, 'fs23', 32)" onmouseover="showTip(event, 'fs23', 32)" class="i">raise</span> (<span onmouseout="hideTip(event, 'fs14', 33)" onmouseover="showTip(event, 'fs14', 33)" class="i">WorkerException</span>(<span class="i">currentWorker</span>, <span class="i">n</span>, <span class="i">e</span>))
    }

    <span class="k">let!</span> <span class="i">results</span> <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Parallel</span> [<span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="n">10</span> <span class="k">-&gt;</span> <span class="i">div</span> <span class="i">i</span> ]
    <span class="k">return</span> <span onmouseout="hideTip(event, 'fs12', 34)" onmouseover="showTip(event, 'fs12', 34)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 35)" onmouseover="showTip(event, 'fs13', 35)" class="i">sum</span> <span class="i">results</span>
}
</code></pre></td>
</tr>
</table>
<p>Which yields the following stacktrace:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="console">FSI_0023+WorkerException: Worker 'mbrace://grothendieck:52789' given input 5 has failed with exception: 
'System.DivideByZeroException: Attempted to divide by zero.
   at FSI_0024.div@88-32.Invoke(Unit unitVar)
   at MBrace.Core.BuilderImpl.Invoke@98.Invoke(Continuation`1 c) in ...'
   at FSI_0024.div@91-34.Invoke(IWorkerRef _arg2)
   at MBrace.Core.Builders.Bind@331-1.Invoke(ExecutionContext ctx, T t) in ...
   at Cloud.Parallel(seq&lt;Cloud&lt;Int32&gt;&gt; computations)
--- End of stack trace from previous location where exception was thrown ---
   at &lt;StartupCode$MBrace-Runtime&gt;.$CloudProcess.AwaitResult@211-2.Invoke(CloudProcessResult _arg2) in ...
   at Microsoft.FSharp.Control.AsyncBuilderImpl.args@835-1.Invoke(a a)
   at MBrace.Core.Internals.AsyncExtensions.Async.RunSync[T](FSharpAsync`1 workflow, FSharpOption`1 ...
   at &lt;StartupCode$FSI_0025&gt;.$FSI_0025.main@()
</code></pre></td></tr></table>
<p>It is also possible to catch exceptions raised by distributed workflows:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">cloud</span> {
    <span class="k">let</span> <span class="i">div</span> <span class="i">m</span> <span class="i">n</span> <span class="o">=</span> <span class="i">cloud</span> { <span class="k">return</span> <span class="i">m</span> <span class="o">/</span> <span class="i">n</span> }
    <span class="k">try</span>
        <span class="k">let!</span> <span class="i">results</span> <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Parallel</span> [<span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="n">10</span> <span class="k">-&gt;</span> <span class="i">div</span> <span class="n">10</span> (<span class="n">5</span> <span class="o">-</span> <span class="i">i</span>) ]
        <span class="k">return</span> <span onmouseout="hideTip(event, 'fs24', 36)" onmouseover="showTip(event, 'fs24', 36)" class="i">Some</span>(<span onmouseout="hideTip(event, 'fs12', 37)" onmouseover="showTip(event, 'fs12', 37)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 38)" onmouseover="showTip(event, 'fs13', 38)" class="i">sum</span> <span class="i">results</span>)
    <span class="k">with</span> <span class="o">:?</span> <span onmouseout="hideTip(event, 'fs25', 39)" onmouseover="showTip(event, 'fs25', 39)" class="i">DivideByZeroException</span> <span class="k">-&gt;</span>
        <span class="k">return</span> <span onmouseout="hideTip(event, 'fs26', 40)" onmouseover="showTip(event, 'fs26', 40)" class="i">None</span>
}
</code></pre></td>
</tr>
</table>
<p>this will suppress any exceptions raised by the <code>Parallel</code> workflow and return a proper value to the client.</p>
<h3><a name="Computing-partial-results" class="anchor" href="#Computing-partial-results">Computing partial results</a></h3>
<p>It is often the case that this default behaviour (i.e. bubbling up and cancellation) may be undesirable,
particularly when we are running an expensive distributed computation. Often, aggregating partial results
is the prefered way to go. Let's see how we can encode this behaviour using MBrace:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">cloud</span> {
    <span class="k">let</span> <span class="i">div</span> <span class="i">m</span> <span class="i">n</span> <span class="o">=</span> <span class="i">cloud</span> { <span class="k">try</span> <span class="k">return</span> <span onmouseout="hideTip(event, 'fs27', 41)" onmouseover="showTip(event, 'fs27', 41)" class="i">Choice1Of2</span>(<span class="i">m</span> <span class="o">/</span> <span class="i">n</span>) <span class="k">with</span> <span class="i">e</span> <span class="k">-&gt;</span> <span class="k">return</span> <span onmouseout="hideTip(event, 'fs28', 42)" onmouseover="showTip(event, 'fs28', 42)" class="i">Choice2Of2</span> <span class="i">e</span> }
    <span class="k">let!</span> <span class="i">results</span> <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Parallel</span> [<span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="n">10</span> <span class="k">-&gt;</span> <span class="i">div</span> <span class="n">10</span> (<span class="n">5</span> <span class="o">-</span> <span class="i">i</span>) ]
    <span class="k">return</span> <span class="i">results</span>
}
</code></pre></td>
</tr>
</table>
<p>Which when executed will result in the following value:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="console">val it : Choice&lt;int,exn&gt; [] =
  [|Choice1Of2 2; Choice1Of2 3; Choice1Of2 5; Choice1Of2 10;
    Choice2Of2
      System.DivideByZeroException: Attempted to divide by zero.
   at FSI_0031.div@140-47.Invoke(Unit unitVar)
   at MBrace.Core.BuilderImpl.Invoke@98.Invoke(Continuation`1 c) in ...
        {Data = dict [];
         HResult = -2147352558;
         HelpLink = null;
         InnerException = null;
         Message = "Attempted to divide by zero.";
         Source = "FSI-ASSEMBLY_f0c42c06-f5a8-45d0-ab7b-2fec2628dff0_10";
         StackTrace = "   at FSI_0031.div@140-47.Invoke(Unit unitVar)"
   at MBrace.Core.BuilderImpl.Invoke@98.Invoke(Continuation`1 c) in ...;
         TargetSite = null;}; Choice1Of2 -10; Choice1Of2 -5; Choice1Of2 -3;
    Choice1Of2 -2; Choice1Of2 -2|]
</code></pre></td></tr></table>
<h2><a name="Fault-tolerance" class="anchor" href="#Fault-tolerance">Fault tolerance</a></h2>
<p>It is important at this point to make a distinction between <em>user exceptions</em>,
i.e. runtime errors generated by user code and <em>faults</em>, errors that happen
because of problems in an MBrace runtime. Faults can happen for a multitude of reasons:</p>
<ul>
<li>Bugs in the runtime implementation.</li>
<li>
Sudden death of a worker node: VMs of a cloud service can often be reset by the
administrator without warning.
</li>
<li>User errors that can cause the worker process to crash, such as stack overflows.</li>
</ul>
<p>Let's have a closer look at an example of a fault, so that we gain a better understanding
of how they work. First, we define a cloud function that forces the death of a worker
by calling <code>Environment.Exit</code> on the process that it is being executed:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 43)" onmouseover="showTip(event, 'fs29', 43)" class="f">die</span> () <span class="o">=</span> <span class="i">cloud</span> { <span onmouseout="hideTip(event, 'fs30', 44)" onmouseover="showTip(event, 'fs30', 44)" class="i">Environment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 45)" onmouseover="showTip(event, 'fs31', 45)" class="i">Exit</span> <span class="n">1</span> }
</code></pre></td>
</tr>
</table>
<p>Let's try to run this on our cluster:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs7', 46)" onmouseover="showTip(event, 'fs7', 46)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 47)" onmouseover="showTip(event, 'fs11', 47)" class="f">Run</span>(<span onmouseout="hideTip(event, 'fs29', 48)" onmouseover="showTip(event, 'fs29', 48)" class="f">die</span>())
</code></pre></td>
</tr>
</table>
<p>Sure enough, after a while we will be receiving the following exception:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="console">MBrace.Core.FaultException: Work item '7927b7ad-f3ee-46cb-928b-92683f279722' was being processed by worker 'mbrace://grothendieck:52789' which has died.
   at &lt;StartupCode$MBrace-Runtime&gt;.$CloudProcess.AwaitResult@211-2.Invoke(CloudProcessResult _arg2) in ...
   at Microsoft.FSharp.Control.AsyncBuilderImpl.args@835-1.Invoke(a a)
   at MBrace.Core.Internals.AsyncExtensions.Async.RunSync[T](FSharpAsync`1 workflow, ...
   at &lt;StartupCode$FSI_0035&gt;.$FSI_0035.main@() in ...
</code></pre></td></tr></table>
<p>Note that this computation has killed one of our worker instances.
If working with MBrace on Azure, the service fabric will ensure that the dead instance will be reset.
If working with MBrace on Thespian, you will have to manually replenish your cluster instance by calling
the <code>cluster.AttachNewLocalWorkers()</code> method.</p>
<p>If we now call</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs7', 49)" onmouseover="showTip(event, 'fs7', 49)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs32', 50)" onmouseover="showTip(event, 'fs32', 50)" class="f">ShowProcesses</span>()
</code></pre></td>
</tr>
</table>
<p>we can indeed verify that the last computation has faulted:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="console">Processes

Name                            Process Id         Status  Execution Time  
----                            ----------         ------  --------------  
      67272653-9d80-403e-848a-8c99760cb943      Completed  00:00:00.5097248
      d1b47fe3-4cc0-4ad9-b22f-5ba2ec9f749e  UserException  00:00:00.8093416
      4e537251-0191-4afe-9a9a-fb3f966ee2ef        Faulted  00:07:07.1084813
</code></pre></td></tr></table>
<p>MBrace will respond to faults in our cloud process by raising a <code>FaultException</code>.
What differentiates fault exceptions from normal user exceptions is that they often
cannot be caught by exception handling logic in the user level. For instance:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">cloud</span> { <span class="k">try</span> <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs29', 51)" onmouseover="showTip(event, 'fs29', 51)" class="i">die</span>() <span class="k">with</span> <span class="o">:?</span> <span class="i">FaultException</span> <span class="k">-&gt;</span> () } <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs7', 52)" onmouseover="showTip(event, 'fs7', 52)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 53)" onmouseover="showTip(event, 'fs11', 53)" class="f">Run</span>
</code></pre></td>
</tr>
</table>
<p>Will not have any effect in the outcome of the computation.
This happens because the exception handling clause is actually part
of the work item which was to be executed by the worker that was killed.
Compare this against</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">cloud</span> { 
    <span class="k">try</span> 
        <span class="k">let!</span> _ <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Parallel</span> [<span onmouseout="hideTip(event, 'fs29', 54)" onmouseover="showTip(event, 'fs29', 54)" class="i">die</span>();<span onmouseout="hideTip(event, 'fs29', 55)" onmouseover="showTip(event, 'fs29', 55)" class="i">die</span>()]
        <span class="k">return</span> ()
    <span class="k">with</span> <span class="o">:?</span> <span class="i">FaultException</span> <span class="k">-&gt;</span> <span class="k">return</span> () 
} <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs7', 56)" onmouseover="showTip(event, 'fs7', 56)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 57)" onmouseover="showTip(event, 'fs11', 57)" class="f">Run</span>
</code></pre></td>
</tr>
</table>
<p>which works as expected since the exception handling logic happens
on the parent work item.</p>
<h3><a name="Working-with-fault-policies" class="anchor" href="#Working-with-fault-policies">Working with fault policies</a></h3>
<p>In stark contrast to our pathological <code>die()</code> example, most real faults
actually happen because of transient errors in cluster deployments.
It is often the case that we want our computation not to stop because
of such minor faults. This is where <em>fault policies</em> come into play.</p>
<p>When sending a computation to the cloud, a fault policy can be specified.
This indicates whether, and for how long a specific faulting computation should
be retried:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// die with a probability of 1 / N</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 58)" onmouseover="showTip(event, 'fs33', 58)" class="f">diePb</span> (<span onmouseout="hideTip(event, 'fs34', 59)" onmouseover="showTip(event, 'fs34', 59)" class="i">N</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs15', 60)" onmouseover="showTip(event, 'fs15', 60)" class="t">int</span>) <span class="o">=</span> <span class="i">cloud</span> { <span class="k">if</span> <span onmouseout="hideTip(event, 'fs1', 61)" onmouseover="showTip(event, 'fs1', 61)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 62)" onmouseover="showTip(event, 'fs35', 62)" class="i">Random</span>()<span class="o">.</span><span class="i">Next</span>(<span class="n">0</span>, <span onmouseout="hideTip(event, 'fs34', 63)" onmouseover="showTip(event, 'fs34', 63)" class="i">N</span>) <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs29', 64)" onmouseover="showTip(event, 'fs29', 64)" class="i">die</span>() }

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 65)" onmouseover="showTip(event, 'fs36', 65)" class="f">test</span>() <span class="o">=</span> <span class="i">cloud</span> {
    <span class="k">let!</span> <span class="i">N</span> <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">GetWorkerCount</span>() <span class="c">// get the current number of workers</span>
    <span class="k">let!</span> _ <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Parallel</span> [ <span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="i">N</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs33', 66)" onmouseover="showTip(event, 'fs33', 66)" class="i">diePb</span> <span class="i">N</span> ]
    <span class="k">return</span> ()
}
</code></pre></td>
</tr>
</table>
<p>the computation as defined above introduces a significant probability of faulting
at some point of its execution. We can compensate by applying the following a
more flexible retry policy:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs7', 67)" onmouseover="showTip(event, 'fs7', 67)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 68)" onmouseover="showTip(event, 'fs11', 68)" class="f">Run</span>(<span onmouseout="hideTip(event, 'fs36', 69)" onmouseover="showTip(event, 'fs36', 69)" class="f">test</span>(), <span class="i">faultPolicy</span> <span class="o">=</span> <span class="i">FaultPolicy</span><span class="o">.</span><span class="i">WithMaxRetries</span> <span class="n">5</span>)
</code></pre></td>
</tr>
</table>
<p>This will cause any faulting part of the computation to yield
a FaultException only after it has faulted more than 5 times.</p>
<p>Fault polices can also be scoped in our cloud code:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">cloud</span> {
    <span class="k">let!</span> <span class="i">results1</span> <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Parallel</span> [<span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="n">10</span> <span class="k">-&gt;</span> <span class="i">cloud</span> { <span class="k">return</span> <span class="i">i</span> <span class="o">*</span> <span class="i">i</span> }]
    <span class="k">let!</span> <span class="i">results2</span> <span class="o">=</span> 
        <span class="i">Cloud</span><span class="o">.</span><span class="i">Parallel</span> [<span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="n">10</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs33', 70)" onmouseover="showTip(event, 'fs33', 70)" class="i">diePb</span> <span class="n">10</span> ]
        <span class="o">|&gt;</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">WithFaultPolicy</span> (<span class="i">FaultPolicy</span><span class="o">.</span><span class="i">InfiniteRetries</span>())

    <span class="k">return</span> (<span class="i">results1</span>, <span class="i">results2</span>)
}
</code></pre></td>
</tr>
</table>
<p>The example above uses the inherited fault policy for the first parallel computation,
whereas the second parallel computation uses a custom fault policy, namely <code>InfiniteRetries</code>.</p>
<h3><a name="Faults-amp-Partial-results" class="anchor" href="#Faults-amp-Partial-results">Faults &amp; Partial results</a></h3>
<p>The question that now arises is how would it be possible to recover partial results of a
distributed computation in the presence of faults? This can be achieved through the use
of runtime introspection primitives:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 71)" onmouseover="showTip(event, 'fs37', 71)" class="f">run</span>() <span class="o">=</span> <span class="i">cloud</span> {
    <span class="k">let!</span> <span class="i">isPreviouslyFaulted</span> <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">IsPreviouslyFaulted</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs38', 72)" onmouseover="showTip(event, 'fs38', 72)" class="i">not</span> <span class="i">isPreviouslyFaulted</span> <span class="k">then</span> <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs29', 73)" onmouseover="showTip(event, 'fs29', 73)" class="i">die</span>()
}

<span onmouseout="hideTip(event, 'fs7', 74)" onmouseover="showTip(event, 'fs7', 74)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 75)" onmouseover="showTip(event, 'fs11', 75)" class="f">Run</span>(<span onmouseout="hideTip(event, 'fs37', 76)" onmouseover="showTip(event, 'fs37', 76)" class="f">run</span>(), <span class="i">faultPolicy</span> <span class="o">=</span> <span class="i">FaultPolicy</span><span class="o">.</span><span class="i">WithMaxRetries</span> <span class="n">1</span>)
</code></pre></td>
</tr>
</table>
<p>The <code>Cloud.IsPreviouslyFaulted</code> primitive gives true if the current work item
is part of a computation that has previously faulted and currently being retried.
We can use this knowledge to dynamically alter its mode of execution.</p>
<p>Let's now have a look at a more useful example. Let's define a parallel combinator
that returns partial results even in the presence of faults.
First, let's define a result type:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs39', 77)" onmouseover="showTip(event, 'fs39', 77)" class="t">Result</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">=</span>
    | <span onmouseout="hideTip(event, 'fs40', 78)" onmouseover="showTip(event, 'fs40', 78)" class="p">Success</span> <span class="k">of</span> <span class="o">&#39;</span><span class="i">T</span>
    | <span onmouseout="hideTip(event, 'fs41', 79)" onmouseover="showTip(event, 'fs41', 79)" class="p">Exception</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs16', 80)" onmouseover="showTip(event, 'fs16', 80)" class="t">exn</span>
    | <span onmouseout="hideTip(event, 'fs42', 81)" onmouseover="showTip(event, 'fs42', 81)" class="p">Fault</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs16', 82)" onmouseover="showTip(event, 'fs16', 82)" class="t">exn</span>
</code></pre></td>
</tr>
</table>
<p>we now define our <code>protectedParallel</code> combinator:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs43', 83)" onmouseover="showTip(event, 'fs43', 83)" class="f">protectedParallel</span> (<span onmouseout="hideTip(event, 'fs44', 84)" onmouseover="showTip(event, 'fs44', 84)" class="i">computations</span> <span class="o">:</span> <span class="i">Cloud</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs45', 85)" onmouseover="showTip(event, 'fs45', 85)" class="t">seq</span>) <span class="o">=</span> <span class="i">cloud</span> {
    <span class="k">let</span> <span class="i">protect</span> (<span class="i">computation</span> <span class="o">:</span> <span class="i">Cloud</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>) <span class="o">=</span> <span class="i">cloud</span> {
        <span class="k">let!</span> <span class="i">faultData</span> <span class="o">=</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">TryGetFaultData</span>()
        <span class="k">match</span> <span class="i">faultData</span> <span class="k">with</span>
        | <span onmouseout="hideTip(event, 'fs26', 86)" onmouseover="showTip(event, 'fs26', 86)" class="i">None</span> <span class="k">-&gt;</span> <span class="c">// computation not faulted, execute normally</span>
            <span class="k">try</span> <span class="k">let!</span> <span class="i">t</span> <span class="o">=</span> <span class="i">computation</span> <span class="k">in</span> <span class="k">return</span> <span onmouseout="hideTip(event, 'fs40', 87)" onmouseover="showTip(event, 'fs40', 87)" class="i">Success</span> <span class="i">t</span>
            <span class="k">with</span> <span class="i">e</span> <span class="k">-&gt;</span> <span class="k">return</span> <span onmouseout="hideTip(event, 'fs41', 88)" onmouseover="showTip(event, 'fs41', 88)" class="i">Exception</span> <span class="i">e</span>

        | <span onmouseout="hideTip(event, 'fs24', 89)" onmouseover="showTip(event, 'fs24', 89)" class="i">Some</span> <span class="i">faultData</span> <span class="k">-&gt;</span> <span class="c">// computation previously faulted, return an exception</span>
            <span class="k">return</span> <span onmouseout="hideTip(event, 'fs42', 90)" onmouseover="showTip(event, 'fs42', 90)" class="i">Fault</span> <span class="i">faultData</span><span class="o">.</span><span class="i">FaultException</span>
    }

    <span class="k">return!</span> 
        <span onmouseout="hideTip(event, 'fs44', 91)" onmouseover="showTip(event, 'fs44', 91)" class="i">computations</span> 
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs46', 92)" onmouseover="showTip(event, 'fs46', 92)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 93)" onmouseover="showTip(event, 'fs47', 93)" class="i">map</span> <span class="i">protect</span>
        <span class="o">|&gt;</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">Parallel</span> 
        <span class="o">|&gt;</span> <span class="i">Cloud</span><span class="o">.</span><span class="i">WithFaultPolicy</span> (<span class="i">FaultPolicy</span><span class="o">.</span><span class="i">WithMaxRetries</span> <span class="n">1</span>)
}
</code></pre></td>
</tr>
</table>
<p>the example makes use of the <code>Cloud.TryGetFaultData()</code> primitive to determine
whether the current computation is a retry of a previously faulted operation.</p>
<p>Let's now test our workflow:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs48', 94)" onmouseover="showTip(event, 'fs48', 94)" class="f">test2</span>() <span class="o">=</span> <span class="i">cloud</span> {
    <span class="k">let</span> <span class="i">d</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs35', 95)" onmouseover="showTip(event, 'fs35', 95)" class="i">Random</span>()<span class="o">.</span><span class="i">Next</span>(<span class="n">0</span>,<span class="n">10</span>)
    <span class="k">if</span> <span class="i">d</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs29', 96)" onmouseover="showTip(event, 'fs29', 96)" class="i">die</span>()
    <span class="k">if</span> <span class="i">d</span> <span class="o">&lt;</span> <span class="n">5</span> <span class="k">then</span> <span class="k">return</span> <span onmouseout="hideTip(event, 'fs49', 97)" onmouseover="showTip(event, 'fs49', 97)" class="i">failwithf</span> <span class="s">&quot;error %d&quot;</span> <span class="i">d</span>
    <span class="k">else</span> <span class="k">return</span> <span class="i">d</span>
}

<span onmouseout="hideTip(event, 'fs43', 98)" onmouseover="showTip(event, 'fs43', 98)" class="f">protectedParallel</span> [<span class="k">for</span> <span onmouseout="hideTip(event, 'fs50', 99)" onmouseover="showTip(event, 'fs50', 99)" class="i">i</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="n">10</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs48', 100)" onmouseover="showTip(event, 'fs48', 100)" class="f">test2</span>() ] <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs7', 101)" onmouseover="showTip(event, 'fs7', 101)" class="i">cluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 102)" onmouseover="showTip(event, 'fs11', 102)" class="f">Run</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Summary" class="anchor" href="#Summary">Summary</a></h2>
<p>In this tutorial, you've learned how to reason about exceptions and faults in MBrace.
Continue with further samples to learn more about the MBrace programming model.</p>
<blockquote>
<p>Note, you can use the above techniques from both scripts and compiled projects. To see the components referenced
by this script, see <a href="ThespianCluster.html">ThespianCluster.fsx</a> or <a href="AzureCluster.html">AzureCluster.fsx</a>.</p>
</blockquote>

<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace System.IO</div>
<div class="tip" id="fs3">namespace MBrace</div>
<div class="tip" id="fs4">namespace MBrace.Core</div>
<div class="tip" id="fs5">module BuilderAsyncExtensions<br /><br />from MBrace.Core</div>
<div class="tip" id="fs6">namespace MBrace.Flow</div>
<div class="tip" id="fs7">val cluster : MBrace.Thespian.ThespianCluster<br /><br />Full name: 10-exceptions-and-fault-tolerance.cluster</div>
<div class="tip" id="fs8">module Config</div>
<div class="tip" id="fs9">val GetCluster : unit -&gt; MBrace.Thespian.ThespianCluster<br /><br />Full name: Config.GetCluster<br /><em><br /><br />&#160;Gets or creates a new Thespian cluster session.</em></div>
<div class="tip" id="fs10">val failwith : message:string -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.failwith</div>
<div class="tip" id="fs11">member MBrace.Runtime.MBraceClient.Run : workflow:MBrace.Core.Cloud&lt;&#39;T&gt; * ?cancellationToken:MBrace.Core.ICloudCancellationToken * ?faultPolicy:MBrace.Core.FaultPolicy * ?target:MBrace.Core.IWorkerRef * ?additionalResources:MBrace.Core.Internals.ResourceRegistry * ?taskName:string -&gt; &#39;T</div>
<div class="tip" id="fs12">type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : [&lt;ParamArray&gt;] indices:int[] -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...<br /><br />Full name: System.Array</div>
<div class="tip" id="fs13">val sum : array:&#39;T [] -&gt; &#39;T (requires member ( + ) and member get_Zero)<br /><br />Full name: Microsoft.FSharp.Collections.Array.sum</div>
<div class="tip" id="fs14">exception WorkerException of worker: obj * input: int * exn: exn<br /><br />Full name: 10-exceptions-and-fault-tolerance.WorkerException</div>
<div class="tip" id="fs15">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs16">type exn = Exception<br /><br />Full name: Microsoft.FSharp.Core.exn</div>
<div class="tip" id="fs17">val e : WorkerException</div>
<div class="tip" id="fs18">override WorkerException.Message : string<br /><br />Full name: 10-exceptions-and-fault-tolerance.WorkerException.Message</div>
<div class="tip" id="fs19">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.sprintf</div>
<div class="tip" id="fs20">WorkerException.worker: obj</div>
<div class="tip" id="fs21">WorkerException.input: int</div>
<div class="tip" id="fs22">WorkerException.exn: exn</div>
<div class="tip" id="fs23">val raise : exn:Exception -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.raise</div>
<div class="tip" id="fs24">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs25">Multiple items<br />type DivideByZeroException =<br />&#160;&#160;inherit ArithmeticException<br />&#160;&#160;new : unit -&gt; DivideByZeroException + 2 overloads<br /><br />Full name: System.DivideByZeroException<br /><br />--------------------<br />DivideByZeroException() : unit<br />DivideByZeroException(message: string) : unit<br />DivideByZeroException(message: string, innerException: exn) : unit</div>
<div class="tip" id="fs26">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs27">union case Choice.Choice1Of2: &#39;T1 -&gt; Choice&lt;&#39;T1,&#39;T2&gt;</div>
<div class="tip" id="fs28">union case Choice.Choice2Of2: &#39;T2 -&gt; Choice&lt;&#39;T1,&#39;T2&gt;</div>
<div class="tip" id="fs29">val die : unit -&gt; &#39;a<br /><br />Full name: 10-exceptions-and-fault-tolerance.die</div>
<div class="tip" id="fs30">type Environment =<br />&#160;&#160;static member CommandLine : string<br />&#160;&#160;static member CurrentDirectory : string with get, set<br />&#160;&#160;static member Exit : exitCode:int -&gt; unit<br />&#160;&#160;static member ExitCode : int with get, set<br />&#160;&#160;static member ExpandEnvironmentVariables : name:string -&gt; string<br />&#160;&#160;static member FailFast : message:string -&gt; unit + 1 overload<br />&#160;&#160;static member GetCommandLineArgs : unit -&gt; string[]<br />&#160;&#160;static member GetEnvironmentVariable : variable:string -&gt; string + 1 overload<br />&#160;&#160;static member GetEnvironmentVariables : unit -&gt; IDictionary + 1 overload<br />&#160;&#160;static member GetFolderPath : folder:SpecialFolder -&gt; string + 1 overload<br />&#160;&#160;...<br />&#160;&#160;nested type SpecialFolder<br />&#160;&#160;nested type SpecialFolderOption<br /><br />Full name: System.Environment</div>
<div class="tip" id="fs31">Environment.Exit(exitCode: int) : unit</div>
<div class="tip" id="fs32">member MBrace.Runtime.MBraceClient.ShowProcesses : unit -&gt; unit</div>
<div class="tip" id="fs33">val diePb : N:int -&gt; &#39;a<br /><br />Full name: 10-exceptions-and-fault-tolerance.diePb<br /><em><br /><br />&#160;die with a probability of 1 / N</em></div>
<div class="tip" id="fs34">val N : int</div>
<div class="tip" id="fs35">Multiple items<br />type Random =<br />&#160;&#160;new : unit -&gt; Random + 1 overload<br />&#160;&#160;member Next : unit -&gt; int + 2 overloads<br />&#160;&#160;member NextBytes : buffer:byte[] -&gt; unit<br />&#160;&#160;member NextDouble : unit -&gt; float<br /><br />Full name: System.Random<br /><br />--------------------<br />Random() : unit<br />Random(Seed: int) : unit</div>
<div class="tip" id="fs36">val test : unit -&gt; &#39;a<br /><br />Full name: 10-exceptions-and-fault-tolerance.test</div>
<div class="tip" id="fs37">val run : unit -&gt; &#39;a<br /><br />Full name: 10-exceptions-and-fault-tolerance.run</div>
<div class="tip" id="fs38">val not : value:bool -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Operators.not</div>
<div class="tip" id="fs39">type Result&lt;&#39;T&gt; =<br />&#160;&#160;| Success of &#39;T<br />&#160;&#160;| Exception of exn<br />&#160;&#160;| Fault of exn<br /><br />Full name: 10-exceptions-and-fault-tolerance.Result&lt;_&gt;</div>
<div class="tip" id="fs40">union case Result.Success: &#39;T -&gt; Result&lt;&#39;T&gt;</div>
<div class="tip" id="fs41">Multiple items<br />union case Result.Exception: exn -&gt; Result&lt;&#39;T&gt;<br /><br />--------------------<br />type Exception =<br />&#160;&#160;new : unit -&gt; Exception + 2 overloads<br />&#160;&#160;member Data : IDictionary<br />&#160;&#160;member GetBaseException : unit -&gt; Exception<br />&#160;&#160;member GetObjectData : info:SerializationInfo * context:StreamingContext -&gt; unit<br />&#160;&#160;member GetType : unit -&gt; Type<br />&#160;&#160;member HelpLink : string with get, set<br />&#160;&#160;member InnerException : Exception<br />&#160;&#160;member Message : string<br />&#160;&#160;member Source : string with get, set<br />&#160;&#160;member StackTrace : string<br />&#160;&#160;...<br /><br />Full name: System.Exception<br /><br />--------------------<br />Exception() : unit<br />Exception(message: string) : unit<br />Exception(message: string, innerException: exn) : unit</div>
<div class="tip" id="fs42">union case Result.Fault: exn -&gt; Result&lt;&#39;T&gt;</div>
<div class="tip" id="fs43">val protectedParallel : computations:&#39;a -&gt; &#39;b<br /><br />Full name: 10-exceptions-and-fault-tolerance.protectedParallel</div>
<div class="tip" id="fs44">val computations : &#39;a</div>
<div class="tip" id="fs45">Multiple items<br />val seq : sequence:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.Operators.seq<br /><br />--------------------<br />type seq&lt;&#39;T&gt; = Collections.Generic.IEnumerable&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.seq&lt;_&gt;</div>
<div class="tip" id="fs46">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs47">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs48">val test2 : unit -&gt; &#39;a<br /><br />Full name: 10-exceptions-and-fault-tolerance.test2</div>
<div class="tip" id="fs49">val failwithf : format:Printf.StringFormat&lt;&#39;T,&#39;Result&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.failwithf</div>
<div class="tip" id="fs50">val i : int</div>

        </div>
        <div class="span3">
          <a href="http://www.mbrace.io/index.html">
            <img src="http://www.mbrace.io/img/mbrace.png" alt="F# Project" style="width:150px;margin:10px" />
          </a>
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">MBrace.Core and MBrace.Azure</li>
            <li><a href="http://www.mbrace.io/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://www.nuget.org/packages/MBrace.Core">Get Library via NuGet</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core">Source Code on GitHub</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core/blob/master/LICENSE.md">License</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core/blob/master/RELEASE_NOTES.md">Release Notes</a></li>

            <li class="nav-header">Getting Started</li>
            <li><a href="http://www.mbrace.io/thespian-tutorial.html">Local cluster</a></li>
            <li><a href="http://www.mbrace.io/azure-tutorial.html">Azure cluster</a></li>
            <li class="divider"></li>
            <li><a target="_blank" href="http://www.mbrace.io/mbrace-plos.pdf">PLOS'13 Publication</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="http://www.mbrace.io/programming-model.html">Programming model</a></li>
            <li><a href="http://www.mbrace.io/reference/core/index.html">API Reference (MBrace.Core)</a></li>
            <li><a href="http://www.mbrace.io/reference/runtime/index.html">API Reference (MBrace.Runtime)</a></li>
            <li><a href="http://www.mbrace.io/reference/flow/index.html">API Reference (MBrace.Flow)</a></li>
            <li class="divider"></li>
            <li><a href="http://www.mbrace.io/reference/thespian/index.html">Reference (Local)</a></li>
            <li><a href="http://www.mbrace.io/reference/azure/index.html">Reference (Azure)</a></li>
              <li><a href="http://www.mbrace.io/reference/aws/index.html">Reference (AWS)</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/mbraceproject/MBrace.Core"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
